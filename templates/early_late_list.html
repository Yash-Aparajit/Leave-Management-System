{% extends "history_base.html" %}
{% block title %}Early / Late History{% endblock %}

{% block history_content %}

<!-- FILTERS -->
<form method="get" class="row g-2 align-items-end mb-3">

  <div class="col-md-2">
    <label class="form-label small">Employee ID</label>
    <input type="text"
           name="employee_id"
           value="{{ q_emp }}"
           class="form-control form-control-sm"
           placeholder="EMP001">
  </div>

  <div class="col-md-2">
    <label class="form-label small">Department</label>
    <select name="department" class="form-select form-select-sm">
      <option value="">All</option>
      {% for d in ['Purchase','ME','HR Admin','Production','Quality','Store','Other'] %}
        <option value="{{ d }}"
          {% if q_dept == d %}selected{% endif %}>
          {{ d }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-2">
    <label class="form-label small">Year</label>
    <input type="number"
           name="year"
           value="{{ q_year }}"
           class="form-control form-control-sm"
           placeholder="2025">
  </div>

  <div class="col-md-2">
    <label class="form-label small">Month</label>
    <input type="number"
           name="month"
           min="1"
           max="12"
           value="{{ q_month }}"
           class="form-control form-control-sm"
           placeholder="12">
  </div>

  <div class="col-md-4 d-flex gap-2">
    <button class="btn btn-sm btn-primary">
      <i class="bi bi-funnel"></i> Apply
    </button>

    <a href="{{ url_for('history_early_late') }}"
       class="btn btn-sm btn-outline-secondary">
      Reset
    </a>

    <a href="{{ url_for('early_late_export', format='xlsx') }}"
       class="btn btn-sm btn-outline-success">
      <i class="bi bi-download"></i> Excel
    </a>
  </div>
</form>

<!-- TABLE -->
<div class="card card-shadow">
  <div class="table-responsive">
    <table class="table table-sm table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Date</th>
          <th>EMP ID</th>
          <th>Name</th>
          <th>Department</th>
          <th>Late Time</th>
          <th>Early Time</th>
          <th>Note</th>
        </tr>
      </thead>

      <tbody>
        {% for r in items %}
        <tr>
          <td>
            {% if r.late_datetime %}
              {{ r.late_datetime.strftime('%d/%m/%Y') }}
            {% elif r.early_datetime %}
              {{ r.early_datetime.strftime('%d/%m/%Y') }}
            {% else %}
              —
            {% endif %}
          </td>

          <td>{{ r.emp_code }}</td>

          <td>{{ r.emp_name }}</td>

          <td>{{ r.department or '-' }}</td>

          <td>
            {% if r.late_datetime %}
              {{ r.late_datetime.strftime('%H:%M') }}
            {% else %}
              —
            {% endif %}
          </td>

          <td>
            {% if r.early_datetime %}
              {{ r.early_datetime.strftime('%H:%M') }}
            {% else %}
              —
            {% endif %}
          </td>

          <td class="text-muted">{{ r.note or '' }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="8" class="text-center text-muted py-3">
            No early / late records found
          </td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>
</div>

{% endblock %}
